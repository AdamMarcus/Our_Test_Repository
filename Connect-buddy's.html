<html>
  <head>
    <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js '></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js '></script>
  </head>
  <body>
    <div id='messagesDiv'></div>
    <form id="lookup">
        <input type='text' id='nameInput' placeholder='Name' >
        <input type='text' id='courseInput' placeholder='course' value='CSCI'>
        <input type='text' id='emailInput' placeholder='email' value = 'a'>
            <input type="submit">
    </form>
    <script>
      var myDataRef = new Firebase('https://studybudee3.firebaseio.com');
      $('#lookup').submit(function (e) {
          e.preventDefault();
          console.log("SUBMIT");
          var name = $('#nameInput').val();
          var course = $('#courseInput').val();
          var email = $('#emailInput').val();
          var enrollee = {
            name: name,
            email: email
          };
          var obj = {};
          obj[course] = {};
          var run = false;
          myDataRef.child(course).on("value", function(snapshot){
            console.log("before if",run, snapshot.key(), snapshot.val());
            if(!run){
              run = true;
              if (snapshot.val() == null) {
                //console.log("does not has val", snapshot.val());
                var objRef = myDataRef.update(obj);
              }
              var emails = "";
              for (var key in snapshot.val())
              {
                //debugger
                emails += snapshot.val()[key].email + ", ";
              }
              alert(emails);
              //alert(findMatches(myDataRef.child(course).enrolees))
              myDataRef.child(course).push(enrollee);
            }
          })
          //myDataRef.push({name: name, text: [text]});
          $('#nameInput').val('');
          $('#courseInput').val('');
          $('#emailInput').val('');

          return false;
      });

      /*function findMatches(_course)
      {
        console.log("In findMatches");
        userEmails = "";
        myDataRef.child(_course).on("value", function(snapshot) {
          console.log("User Emails" + snapshot.val().email);
          userEmails += snapshot.val().email + ", ";
      })
        return userEmails;
      }*/
      // function findMatches(_enrolees)
      // {
      //   console.log("In findMatches");
      //   userEmails = "";
      //   for (var email in _enrolees)
      //   {
      //     console.log(email);
      //     userEmails += email + ", ";
      //   }
      //   return userEmails;
      // }

    </script>
  </body>
</html>
